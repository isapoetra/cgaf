(function(a){var b=function(){};b.prototype={defaults:{floatMode:!0,appId:null},init:function(b){if(!this.initialize){this.configs=a.extend(this.defaults,b||{}),this.configs.appId||(this.configs.appId=cgaf.getConfig("appid")),this.initialize=!0,this.online=null;var c=this.container=a("#chat-container");c.length===0&&(c=this.container=a('<div id="chat-container" class="chat-container'+(this.configs.floatMode?" float":"")+'">'+'    <div class="chat-message-container">'+'      <div class="message">'+"      </div>"+'      <div class="chat-message-action">'+'        <input type="text" id="msg">'+'        <button class="btn" type="button" id="send">Go!</button>'+"      </div>"+"    </div>"+'    <div class="chat-contacts">'+'      <div class="header">'+'        <label class="label label-status label-important ">Offline</label>'+'        <div class="btn-group">'+'          <button class="btn btn-log"><i class="icon icon-list-alt"></i></button>'+'          <button class="btn btn-refresh"><i class="icon icon-refresh"></i></button>'+"        </div>"+"      </div>"+'      <ul class="contact-list"></ul>'+"    </div>"+'    <div class="chat-log"></div>'+"</div>").appendTo(this.configs.floatMode?"body":"#wrapper")),this.configs.floatMode&&c.hide();var d=c.find(".label-status"),e=c.find("#connect"),f=c.find("#disconnect"),g=c.find("#send"),h=c.find("#msg"),i=c.find(".message"),j=this;this.setOnline(!1),WebPush.log=function(a){j.log(a,"LOG : ")};var k=this.server=new WebPush("ws://localhost:8088/");this.$log=c.find(".chat-log"),this.$contactList=c.find(".contact-list"),g.addClass("disabled"),c.find(".btn-refresh").click(a.proxy(this,"refreshContactList")),k.bind("open",function(){j.setOnline(!0),j.refreshContactList()}),c.find(".btn-log").click(function(b){b.preventDefault();var c=j.container.find(".chat-log");c.toggle(),c.is(":visible")?a(this).addClass("active"):a(this).removeClass("active")}),k.bind("connection_disconnected",function(){j.setOnline(!1)}),k.bind("close",function(){j.setOnline(!1)}),k.bind("connection_failed",function(){j.setOnline(!1)}),k.bind("message",function(b){var c=JSON.parse(b);j.log(b,"&lt;");var d=new Date;switch(c.service){case"chat":switch(c.action){case"userinfo":break;case"contact_list":j.refreshContactList(c.data,!0);break;case"error":j.log(c.message,"ERROR");break;default:i.append('<div><span class="label label-info t">'+d.toLocaleTimeString()+"</span>"+'<a class="from" target="__dialog" href="'+c.from+'"><span>'+c.from+"</span></a>"+'<span class="m">'+c.data+"</div></div>").find(".from").click(function(b){b.preventDefault(),j.send({action:"userinfo",userid:a(this).attr("href")})})}}}),f.click(function(a){a.preventDefault(),k.disconnect()}),e.click(function(a){a.preventDefault(),k.connect()}),d.click(function(){j.online?j.server.disconnect():j.server.connect()}),g.click(function(){if(!!j.online){var a=new Date;i.append('<div><span class="label label-important s">'+a.toLocaleTimeString()+'</span><span class="m">'+h.val()+"</div></div>"),j.send({action:"message",data:h.val()}),h.val("")}}),a(window).resize(a.proxy(this,"resetui")),this.resetui()}},refreshContactList:function(b,c){if(b&&c){this.$contactList.empty();for(var d in b)a("<li>"+b[d].id+"</li>").appendTo(this.$contactList)}else this.send({service:"chat",action:"contact_list"})},log:function(a,b){b=b||"&gt;",this.container.find(".chat-log").append("<div>"+b+":"+JSON.stringify(a)+"</div>")},send:function(a){a.appId||(a.appId=this.configs.appId),a.service||(a.service="chat"),this.log(a,"&gt;&nbsp;"),this.server.send(JSON.stringify(a))},setOnline:function(a){if(this.online!==a){this.online=a;var b=this.container.find(".label-status"),c=this.container.find("#send"),d=this.container.find("#msg");a?(this.container.find(".btn-refresh").removeClass("disabled"),d.attr("disabled",!1),b.removeClass("label-important").addClass("label-success").html("Online"),d.removeClass("disabled"),c.removeClass("disabled")):(d.attr("disabled","disabled"),this.container.find(".btn-refresh").addClass("disabled"),c.addClass("disabled"),b.removeClass("label-success").addClass("label-important").html("Offline"))}},resetui:function(){if(this.container&&this.container.is(":visible")){this.configs.floatMode||(this.container.closest("body").closest("html").css({overflow:"hidden"}),this.container.parent().css({padding:0}));var b=this.container.offset();this.container.css({height:(this.configs.floatMode?a(window).height()-b.top*2:a(window).height()-(40+b.top))+"px",left:(a(window).width()-this.container.width())/2+"px"})}},showMenu:function(a){this.configs.floatMode&&this.container.toggle(),this.resetui()}},a.chat=new b})(jQuery)